<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reuniones</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="style.css" rel="stylesheet" />
    <link href="styles/reuniones.css" rel="stylesheet" />
  </head>

  <body>
    <!-- NAVBAR -->
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark"
      id="menu"
      style="min-height: 56px"
    ></nav>
    <div
      id="bannerEstado"
      class="alert text-center m-0 py-2 d-none banner"
      role="alert"
    ></div>

    <!-- CONTENIDO DE LA SECCI√ìN -->
    <div class="marginBody">
      <!-- Bot√≥n Crear -->
      <div class="d-flex justify-content-between mb-3">
        <h3>üìÖ Reuniones</h3>
        <div class="d-flex gap-1">
          <button
            class="btn btn-primary d-flex align-items-center"
            title="Crear nueva reuni√≥n"
            onclick="nuevaReunion()"
          >
            <span class="me-2 d-none d-sm-inline">‚ûï Crear</span>
            <span class="d-inline d-sm-none">‚ûï</span>
          </button>
          <button
            class="btn btn-primary d-flex align-items-center"
            onclick=""
            title="Descargar listado"
          >
            <span class="me-2 d-none d-sm-inline">üìÑ Descargar listado</span>
            <span class="d-inline d-sm-none">üìÑ</span>
          </button>
          <button
            class="btn btn-primary d-flex align-items-center"
            onclick="actualizar(); "
            title="Actualizar informaci√≥n"
          >
            <span class="me-2 d-none d-sm-inline">üîÑ Actualizar</span>
            <span class="d-inline d-sm-none">üîÑ</span>
          </button>
        </div>
      </div>

      <!-- FILTRO A√ëO MES -->
      <div class="row g-2 mb-3">
        <div class="col-md-6">
          <label for="anio" class="form-label"
            >A√±o <span class="text-danger">*</span></label
          >
          <select class="form-select" id="anio" required></select>
        </div>
        <div class="col-md-6">
          <label for="mes" class="form-label">Mes</label>
          <select class="form-select" id="mes" required></select>
        </div>
      </div>

      <!-- TABLA REUNIONES -->
      <div id="tablasReuniones" class="grid-2"></div>
    </div>

    <!-- Modal Crear/Editar reuni√≥n-->
    <div
      class="modal fade"
      id="modalReunion"
      tabindex="-1"
      aria-labelledby="modalReunionLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <form id="formReunion" data-edicion-id="">
            <div class="modal-header main">
              <h5 class="modal-title" id="modalReunionLabel">
                ‚ûï Crear nueva reuni√≥n
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>
            <div class="modal-body">
              <!-- Datos b√°sicos -->
              <div class="row g-2">
                <div class="col-md-4">
                  <label for="fecha" class="form-label"
                    >Fecha <span class="text-danger">*</span></label
                  >
                  <input type="date" class="form-control" id="fecha" />
                </div>
                <div class="col-md-2">
                  <label for="cancion" class="form-label"
                    >Canci√≥n <span class="text-danger">*</span></label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="cancionIni"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="presidente" class="form-label"
                    >Presidente <span class="text-danger">*</span></label
                  >
                  <div class="d-flex">
                    <input
                      disabled
                      type="text"
                      class="form-control"
                      id="presidente"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      onclick="abrirSelectorPublicador('presidente', 'pdteVida')"
                    >
                      üîç
                    </button>
                  </div>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-6">
                  <label for="consejAux" class="form-label"
                    >Consejero sala auxiliar<span class="text-danger"
                      >*</span
                    ></label
                  >
                  <div class="d-flex">
                    <input
                      disabled
                      type="text"
                      class="form-control"
                      id="consejAux"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      onclick="abrirSelectorPublicador('consejAux', 'consejAux')"
                    >
                      üîç
                    </button>
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="oracionIni" class="form-label"
                    >Oraci√≥n inicial<span class="text-danger">*</span></label
                  >
                  <div class="d-flex">
                    <input
                      disabled
                      type="text"
                      class="form-control"
                      id="oracionIni"
                      required
                    />
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      onclick="abrirSelectorPublicador('oracionIni', 'oracion')"
                    >
                      üîç
                    </button>
                  </div>
                </div>
              </div>

              <!-- Tesoros de la biblia -->
              <div class="mt-3">
                <h5
                  style="background-color: #575a5d; color: white; height: 30px"
                >
                  üíé Tesoros de la Biblia
                </h5>
                <div class="row g-2">
                  <div class="col-md-6">
                    <label for="tesoros" class="form-label"
                      >T√≠tulo <span class="text-danger">*</span></label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="tesorosTitulo"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="tesorosEnc" class="form-label"
                      >Encargado <span class="text-danger">*</span></label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="tesorosEnc"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('tesorosEnc', 'tesoros')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                </div>
                <div class="row g-2 mt-2">
                  <div class="col-md-4">
                    <label for="perlasEnc" class="form-label"
                      >Busquemos perlas escondidas<span class="text-danger"
                        >*</span
                      ></label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="perlasEnc"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('perlasEnc', 'perlas')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="lecturaEnc" class="form-label"
                      >Lectura de la Biblia (Principal)<span class="text-danger"
                        >*</span
                      ></label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="lecturaEnc"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('lecturaEnc', 'asignaciones')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="lecturaAuxEnc" class="form-label"
                      >Lectura de la Biblia (Auxiliar)</label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="lecturaAuxEnc"
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('lecturaAuxEnc', 'asignaciones')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Seamos mejores maestros -->
              <div class="mt-3" id="seccionSmm">
                <div class="d-flex justify-content-between">
                  <h5
                    style="
                      background-color: #be8900;
                      color: white;
                      width: 80%;
                      height: 30px;
                    "
                  >
                    üåæ Seamos mejores maestros
                  </h5>
                  <button
                    class="btn btn-primary d-flex align-items-center"
                    type="button"
                    title="Agregar nueva asignaci√≥n"
                    onclick="agregarSeccionSMM()"
                  >
                    <span class="me-2 d-none d-sm-inline"
                      >‚ûï Agregar asignaci√≥n</span
                    >
                    <span class="d-inline d-sm-none">‚ûï</span>
                  </button>
                </div>
              </div>

              <!-- Nuestra vida cristiana -->
              <div class="mt-3">
                <div class="d-flex justify-content-between">
                  <h5
                    style="
                      background-color: #7e0024;
                      color: white;
                      width: 80%;
                      height: 30px;
                    "
                  >
                    üêë Nuestra vida cristiana
                  </h5>
                  <button
                    class="btn btn-primary d-flex align-items-center"
                    type="button"
                    title="Agregar nueva asignaci√≥n"
                    onclick="agregarSeccionNVC()"
                  >
                    <span class="me-2 d-none d-sm-inline"
                      >‚ûï Agregar asignaci√≥n</span
                    >
                    <span class="d-inline d-sm-none">‚ûï</span>
                  </button>
                </div>
                <div class="row g-2">
                  <div class="d-flex" style="height: 35px">
                    <label class="form-label"
                      >Canci√≥n <span class="text-danger">*</span></label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="cancionInt"
                      required
                      style="width: 80px; margin-left: 1rem"
                    />
                  </div>
                </div>

                <div id="seccionesNvc"></div>

                <div class="row g-2">
                  <div class="col-md-6">
                    <label class="form-label"
                      >Estudio b√≠blico de la congregaci√≥n (Conductor)
                      <span class="text-danger">*</span>
                    </label>
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="estudioLibro"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('estudioLibro', 'nuestraVida')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label"
                      >Lector <span class="text-danger">*</span></label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="lectorEstudioLibro"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('lectorEstudioLibro', 'lecturaLibro')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                </div>

                <div class="row g-2 mt-2">
                  <div class="col-md-4">
                    <label class="form-label"
                      >Canci√≥n final
                      <span class="text-danger">*</span>
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="cancionFin"
                      required
                    />
                  </div>
                  <div class="col-md-8">
                    <label class="form-label"
                      >Oraci√≥n final <span class="text-danger">*</span></label
                    >
                    <div class="d-flex">
                      <input
                        disabled
                        type="text"
                        class="form-control"
                        id="oracionFin"
                        required
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="abrirSelectorPublicador('oracionFin', 'oracion')"
                      >
                        üîç
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal-footer p-0 pt-2 mt-2">
                <button type="submit" class="btn btn-success">
                  üíæ Guardar
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  ‚ùå Cancelar
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal publicadores-->
    <div class="modal fade" id="modalSeleccionPublicador" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content custom-shadow">
          <div class="modal-header second">
            <h5 class="modal-title">Selecciona un publicador</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div class="d-flex gap-3 mb-3">
              <input
                type="text"
                id="texto-buscador"
                class="form-control"
                placeholder="Buscar..."
                oninput="filtrarPublicador()"
              />
              <select
                class="form-select"
                id="filtro-buscador"
                required
                onchange="filtrarPublicador()"
              >
                <option value="todos" selected>Todos</option>
                <option value="sexoM">Hombres</option>
                <option value="sexoF">Mujeres</option>
                <option value="Precursor regular">Precursores</option>
                <option value="Anciano">Ancianos</option>
                <option value="Siervo ministerial">
                  Siervos ministeriales
                </option>
                <option value="No bautizado">No bautizados</option>
              </select>
            </div>
            <table class="table table-hover" id="tablaPublicadoresModal">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Grupo</th>
                  <th>√öltima asig.</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
    <script src="scripts/date-functions.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        await cargarMenuYScripts();
        cargarAniosSelect("anio");
        cargarMesesSelect("mes");
        renderReuniones();
      });
    </script>
  </body>
</html>
